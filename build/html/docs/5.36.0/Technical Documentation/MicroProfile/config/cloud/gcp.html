<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GCP Cloud Config Source :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">docs</a></li>
    <li><a href="gcp.html">GCP Cloud Config Source</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/ondro-poc/docs/modules/ROOT/pages/Technical%20Documentation/MicroProfile/config/cloud/gcp.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">GCP Cloud Config Source</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The GCP cloud config source takes configuration properties from GCP Secret Manager.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gcp_service_account"><a class="anchor" href="#_gcp_service_account"></a>GCP Service Account</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to connect to GCP Secret Manager you need to know your project name as well as have a service account access token. Assuming you already have a GCP project and a secret created in GCP Secrets Manager, you need to create a service account which Payara Server will use to access your GCP Secrets.</p>
</div>
<div class="paragraph">
<p>Visit the GCP cloud console: <a href="https://console.cloud.google.com/" class="bare">https://console.cloud.google.com/</a></p>
</div>
<div class="paragraph">
<p>Firstly, make sure you&#8217;re on the right project. You can find your project name at the top of the GCP console.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/microprofile/config/cloud/gcp/project-name.png" alt="GCP Project name"></span></p>
</div>
<div class="paragraph">
<p>Next, visit the service account section of the project. You can find this from the top left menu &#8594; <em>IAM &amp; Admin</em> &#8594; <em>Service Accounts</em>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/microprofile/config/cloud/gcp/service-accounts.png" alt="GCP Service Accounts"></span></p>
</div>
<div class="paragraph">
<p>From here you can create a new service account. Skip this step if you already have a service account you want to use.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/microprofile/config/cloud/gcp/new-service-account.png" alt="GCP new Service Account"></span></p>
</div>
<div class="paragraph">
<p>After this you&#8217;ll need to add roles to your service account</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/microprofile/config/cloud/gcp/service-account-roles.png" alt="GCP Service Account roles"></span></p>
</div>
<div class="paragraph">
<p>You have a selection of roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em><strong>Secret Manager Admin</strong></em> - full admin rights to manage secrets. Recommended when you want to delete or modify secrets through Payara Server</p>
</li>
<li>
<p><em><strong>Secret Manager Secret Accessor</strong></em> - ability to view secrets. Recommended when you only want to retrieve secrets through Payara Server</p>
</li>
<li>
<p><em><strong>Secret Manager Secret Version Adder</strong></em> - allows setting secret values</p>
</li>
<li>
<p><em><strong>Secret Manager Secret Version Manager</strong></em> - allows deleting secret values</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add whichever of these is appropriate for your use case.</p>
</div>
<div class="paragraph">
<p>Skip step 3 if following the wizard, as no physical user will be requires to use this service account.</p>
</div>
<div class="paragraph">
<p>Next, you&#8217;ll need to download the access key for this service account.</p>
</div>
<div class="paragraph">
<p>Select the options icon for the service account you plan to use.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/microprofile/config/cloud/gcp/service-account-key.png" alt="GCP Service Account Access Key"></span></p>
</div>
<div class="paragraph">
<p>You&#8217;ll be presented with an option to download the key in <code>JSON</code> or <code>P12</code> format. The GCP config source currently requires that the <code>JSON</code> format be used, so select this one.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/microprofile/config/cloud/gcp/json-key-type.png" alt="JSON Access Key"></span></p>
</div>
<div class="paragraph">
<p>This downloaded file can now be used by Payara Server to access GCP Secrets.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure GCP Secrets either via the admin console or the <em>asadmin</em> utility. You&#8217;ll need the JSON key file created from the GCP console in the previous section, as well as the name of the project that you intend to use. Make sure that the GCP Secret Manager has been enabled for the specified project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The JSON key file will be copied into the Payara Server <code>config/</code> directory, so it isn&#8217;t required after passing it to the GCP Config Source configuration.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_from_the_admin_console"><a class="anchor" href="#_from_the_admin_console"></a>From the Admin Console</h3>
<div class="paragraph">
<p>To configure the config source from the admin console, go to <code>Configs</code> &#8594; <code>your-config</code> &#8594; <code>MicroProfile</code> &#8594; <code>Config</code> &#8594; <code>GCP Secrets</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/microprofile/config/cloud/gcp/admin-console-config.png" alt="Payara Server Administration Console configuration route"></span></p>
</div>
<div class="paragraph">
<p>From here you can pass the absolute path to the json key file downloaded in the previous section, as well as the project name. You can also decide whether to apply these changes dynamically or on the next server restart. If the config source is enabled or disabled dynamically it will take effect across the server immediately.</p>
</div>
</div>
<div class="sect2">
<h3 id="_from_the_command_line"><a class="anchor" href="#_from_the_command_line"></a>From the Command Line</h3>
<div class="paragraph">
<p>To configure the GCP Secrets Cloud Config Source from the command line, use the <code>set-gcp-config-source-configuration</code> asadmin command, specifying the required parameters like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set-gcp-config-source-configuration --dynamic true --enabled true --jsonKeyFile /path/to/token/file.json --projectName project-name</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>--enabled</code> and <code>--dynamic</code> options to enable or disable the GCP Config Source on demand. You should pass the path to the json key file downloaded in the previous section to the <code>--jsonKeyFile</code> parameter.</p>
</div>
<div class="paragraph">
<p>Also, you can retrieve the current configuration for the GCP Config Source using the <code>get-gcp-config-source-configuration</code> asadmin command like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; get-gcp-config-source-configuration

Enabled  Project Name  JSON Key File
true     payara-test   payara-test-8a8aa4fbb520.json</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provided the required roles have been assigned to the Service Account in the GCP console, the secrets can be injected into any applicable MicroProfile Config injection point as with any other Config Source. The secrets can also be fetched, created and deleted from the <code>asadmin</code> utility.</p>
</div>
<div class="paragraph">
<p>To fetch a secret from GCP Secret Manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; get-config-property --source cloud --sourceName gcp --propertyName mysecret

secretvalue</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create or change a secret from GCP Secret Manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set-config-property --source cloud --sourceName gcp --propertyName mysecret --propertyValue secretvalue</code></pre>
</div>
</div>
<div class="paragraph">
<p>To delete a secret from GCP Secret Manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; delete-config-property --source cloud --sourceName gcp --propertyName mysecret</code></pre>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
