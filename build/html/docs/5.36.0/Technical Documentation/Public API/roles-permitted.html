<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RolesPermitted Support :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">docs</a></li>
    <li><a href="roles-permitted.html">RolesPermitted Support</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/ondro-poc/docs/modules/ROOT/pages/Technical%20Documentation/Public%20API/roles-permitted.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">RolesPermitted Support</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Since Payara Server &amp; Payara Micro 4.1.2.182 and 5.182</em></p>
</div>
<div class="paragraph">
<p>The Payara Public API provides a <code>@RolesPermitted</code> annotation that creates an authorisation interceptor for usage with CDI beans. This largely works in the same way as the <code>@RolesAllowed</code> common annotation, which in Java EE/Jakarta EE is primarily used by the EJB specification.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The authorisation interceptor is defined through the <code>@RolesPermitted</code> annotation. Specifying this on an interceptable method of a non-passivation capable CDI bean will make that method eligible for interception by the corresponding interceptor. This interceptor will check that the caller of a method is any or all of the specified roles. If this holds, the call to the method proceeds. If not, an exception of type <code>CallerAccessException</code> is thrown.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The annotation can alternatively be placed at the class level of a CDI bean, in which case it will apply to all interceptable methods of that bean.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Examples of a non-passivation capable CDI bean are beans defined in the Request and Application scope.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="usage-example"><a class="anchor" href="#usage-example"></a>Example</h3>
<div class="paragraph">
<p>Here&#8217;s an example of defining the roles authorized to call a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequestScoped
public class TestRolesPermitted {

    @Inject
    Principal principal;

    @RolesPermitted("payaraAdmin")
    public String getUserName() {
        return principal.getName();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/javaee-samples/vendoree-samples/tree/master/payara/rolesPermitted">this sample project</a> for a more detailed example.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>@RolesPermitted</code> annotation has several configuration options.</p>
</div>
<div class="paragraph">
<p>They are detailed below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A static list of comma-separated roles which are allowed to access this method, or an EL expression used to resolve this list at runtime (<em>see below</em>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>semantics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether accessing caller must be in any one of the given roles (<code>OR</code>) or all given roles (<code>AND</code>). Defaults to <code>OR</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="dynamic-roles"><a class="anchor" href="#dynamic-roles"></a>Dynamic Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Since Payara Server &amp; Payara Micro 5.193</em></p>
</div>
<div class="paragraph">
<p>The <code>@RolesPermitted</code> annotation also allows to dynamically specify authorization roles that are allowed to call bean methods at runtime. With this feature, is possible to instruct the container to allow specific roles based on specific contextual information.</p>
</div>
<div class="paragraph">
<p>Dynamic roles are defined using an <em>Expression Language (EL) 3.0</em> <code>String</code> value which should resolve to a valid <code>String</code> array or <code>Collection</code> that corresponds to the roles permitted to call the corresponding method. This expression value has contextual access to any CDI-scoped bean at the time of the method call.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As a reminder, you can use the <code>self</code> bean name in order to refer to the method&#8217;s bean and access any of its methods and properties at runtime.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In order to access the values of any relevant parameters via CDI beans in the method&#8217;s signature, annotate them with the <code>javax.inject.Named</code> CDI annotation, and assign them the name which will be used in the expression value. If no names are provided for these parameters and the method only has one parameter, then it will be available as a bean with the <code>param</code> name.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="usage-examples"><a class="anchor" href="#usage-examples"></a>Examples</h3>
<div class="sect3">
<h4 id="basic-example"><a class="anchor" href="#basic-example"></a>Basic Example</h4>
<div class="paragraph">
<p>The following example illustrates how to dynamically resolve an specific role based on the data received in the parameter. Assume that the application has declared multiple roles for each of one of the registered customers. Let&#8217;s say that the application has 3 customers named <code>A</code>, <code>B</code> and <code>C</code>, in which case the following roles are defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Customer_A</code></p>
</li>
<li>
<p><code>Customer_B</code></p>
</li>
<li>
<p><code>Customer_C</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With each role granting authorization to each customer respectively. If we have a method for updating a customer&#8217;s data based on a parameter received you can setup the corresponding authorization constraint like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RolesPermitted("#{'Customer_'.concat(customer.name)}")
public void updateCustomer(@Named("customer") Customer customer){
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can observe, the role name is evaluated at runtime by concatenating the <code>Customer_</code> prefix with the name of the customer, which is retrieved using the <code>customer</code> bean (which is injected in the context using the <code>@Named</code> annotation).</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced-expressions-example"><a class="anchor" href="#advanced-expressions-example"></a>Advanced Expression Example</h4>
<div class="paragraph">
<p>Based on the previous example, you can also let the corresponding expression be evaluated by calling a bean&#8217;s method instead. Imagine that you could use a second variant, namely a product&#8217;s name; in conjunction with the customer&#8217;s name to evaluate authorization at runtime like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RolesPermitted("#{self.findRole(customer, product)}")
public void updateCustomer(@Named("customer") Customer customer, @Named("product") Product product){
    ...
}

public String findRole(Customer customer, Product product) {
    return customer.getType() + "_" + product.getModel();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By using the <code>self</code> bean name, we can call the bean&#8217;s <code>findRole</code> method and pass it the two parameters defined in its signature.</p>
</div>
</div>
<div class="sect3">
<h4 id="default-param-example"><a class="anchor" href="#default-param-example"></a>Default Parameter Example</h4>
<div class="paragraph">
<p>If no parameters are annotated with the <code>Named</code> annotation and the method has a single parameter then the <code>param</code> bean name can be used as a default reference like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RolesPermitted("#{'CustomerCare_'.concat(param.name)}")
public void updateCustomer(Customer customer){
    ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extra_resources"><a class="anchor" href="#_extra_resources"></a>Extra Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="https://javaee.github.io/javaee-spec/javadocs/javax/annotation/security/RolesAllowed.html">@RolesAllowed</a> for the original annotation on which this annotation is based.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
