<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying Applications on Micro Programmatically :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../../index.html">docs</a></li>
    <li><a href="Deploy%20Applications%20Programmatically.html">Deploying Applications on Micro Programmatically</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/ondro-poc/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Micro%20Documentation/Payara%20Micro%20Configuration%20and%20Management/Micro%20Management/Deploying%20Applications/Deploy%20Applications%20Programmatically.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Deploying Applications on Micro Programmatically</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can deploy applications onto Payara Micro programmatically via its API.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-applications-using-an-asadmin-command"><a class="anchor" href="#deploying-applications-using-an-asadmin-command"></a>Deploying Applications Using an asadmin Command</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applications can be deployed using the equivalent administration (<code>asadmin</code>) commands present on Payara Server.</p>
</div>
<div class="sect2">
<h3 id="deploying-on-a-local-instance"><a class="anchor" href="#deploying-on-a-local-instance"></a>Deploying on a Local Instance</h3>
<div class="paragraph">
<p>It&#8217;s possible to use the <code>run(Collection&lt;InstanceDescriptor&gt; members, String command, String&#8230;&#8203; args )</code>
method to run the <code>deploy</code> asadmin command. To deploy to a single instance, you must create a <code>members</code> <code>Collection</code> object only containing a single instance like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.PayaraMicro;
import fish.payara.micro.BootstrapException;
import fish.payara.micro.PayaraMicroRuntime;
import fish.payara.micro.services.data.InstanceDescriptor;
import java.util.ArrayList;
import java.util.Collection;

public class EmbeddedPayara {
    public static void main(String[] args) throws BootstrapException {
        PayaraMicroRuntime runtime = PayaraMicro.getInstance().setHttpAutoBind(true).bootstrap();

        // Get a Collection with all running instances in the local runtime's cluster
        Collection&lt;InstanceDescriptor&gt; allInstances = runtime.getClusteredPayaras();

        // Create a Collection to use as a subset
        Collection&lt;InstanceDescriptor&gt; subset = new ArrayList&lt;&gt;();

        // Loop through all instances
        for (InstanceDescriptor instance : allInstances){
            // Only add the local instance
            if (instance == runtime.getLocalDescriptor()){
                subset.add(instance);
                break;
            }
        }

        // Run the deploy asadmin command on the subset Collection
        runtime.run(subset, "deploy", "/home/user/test.war");
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-on-multiple-instances"><a class="anchor" href="#deploying-on-multiple-instances"></a>Deploying on Multiple Running Instances</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the <code>run</code> method to run the <code>deploy</code> asadmin command on multiple Payara Micro instances that belong to the same cluster. There are two <code>run</code> method variants available for running administration commands: One which runs an <code>asadmin</code> command on a subset of instances in a cluster, and another than runs an <code>asadmin</code> command on ALL instances in a cluster.</p>
</div>
<div class="paragraph">
<p>Here is an example of deploying an application to ALL instances in a cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.PayaraMicro;
import fish.payara.micro.BootstrapException;
import fish.payara.micro.PayaraMicroRuntime;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
        PayaraMicroRuntime runtime = PayaraMicro.getInstance().setHttpAutoBind(true).bootstrap();

        // Run the deploy asadmin command on all instances in the runtime's cluster
        runtime.run("deploy", "/home/user/test.war");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the example for <a href="#deploying-on-a-local-instance">deploying on local instance</a> on how to use the <code>run</code> method on a subset of instances in a cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-an-application-programmatically-during-bootstrap"><a class="anchor" href="#deploying-an-application-programmatically-during-bootstrap"></a>Deploying an Application Programmatically during Bootstrap</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two methods you can use to deploy an application during Payara Micro&#8217;s bootstrap process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>addDeployment(String pathToWar)</code></p>
</li>
<li>
<p><code>addDeploymentFile(File file)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first, <code>addDeployment(String pathToWar)</code>, accepts a String that points to the path of the artefact to be deployed. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.BootstrapException;
import fish.payara.micro.PayaraMicro;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
        PayaraMicro.getInstance().addDeployment("/home/user/example.war").bootStrap();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second method, <code>addDeploymentFile(File file)</code>, functions in the same way, but takes a <code>File</code> object instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.BootstrapException;
import fish.payara.micro.PayaraMicro;
import java.io.File;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
        File file = new File("/home/user/example.war");
        PayaraMicro.getInstance().addDeploymentFile(file).bootStrap();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike when controlling Payara Micro from the command line, you can split the instance initialization and configuration across multiple method invocations. For example, to deploy an application and start the instance on separate method calls, you can run the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.BootstrapException;
import fish.payara.micro.PayaraMicro;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
        PayaraMicro micro = PayaraMicro.getInstance();
        micro.addDeployment("/home/user/example.war");
        micro.bootStrap();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use this strategy to deploy multiple deployments by calling <code>addDeployment</code> multiple times, or use <code>setDeploymentDir</code> to point to a deployment directory that contains the applications to deploy.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-an-application-programmatically-after-bootstrap"><a class="anchor" href="#deploying-an-application-programmatically-after-bootstrap"></a>Deploying an Application Programmatically After Bootstrap</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three methods available for deploying an application to a running instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deploy(File war)</code></p>
</li>
<li>
<p><code>deploy(String name, InputStream is)</code></p>
</li>
<li>
<p><code>deploy(String name, String contextRoot, InputStream is)</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="deployfile-war"><a class="anchor" href="#deployfile-war"></a><code>deploy(File war)</code></h3>
<div class="paragraph">
<p>The first method works in the exact same way as the <code>addDeploymentFile</code> method described in the  <a href="#deploying-an-application-programmatically-during-bootstrap">Deploying Programmatically during Bootstrap</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploystring-name-inputstream-is"><a class="anchor" href="#deploystring-name-inputstream-is"></a><code>deploy(String name, InputStream is)</code></h3>
<div class="paragraph">
<p>This method allows you to deploy WAR files using an <code>InputStream</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.PayaraMicro;
import fish.payara.micro.BootstrapException;
import fish.payara.micro.PayaraMicroRuntime;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.logging.Level;
import java.util.logging.Logger;

public class EmbeddedPayara {
    public static void main(String[] args) throws BootstrapException{
        PayaraMicroRuntime instance = PayaraMicro.bootstrap();

        try (InputStream is = new FileInputStream("/home/user/test.war")){
            instance.deploy("test", is);
        }
        catch (IOException ex){
            Logger.getLogger(EmbeddedPayara.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploystring-name-string-contextroot-inputstream-is"><a class="anchor" href="#deploystring-name-string-contextroot-inputstream-is"></a><code>deploy(String name, String contextRoot, InputStream is)</code></h3>
<div class="paragraph">
<p>This method works in the same way as the previous one, but allows you to specify the context root of the application at the same time. The following example would deploy the <code>test</code> application to a context root of <code>/app</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.PayaraMicro;
import fish.payara.micro.BootstrapException;
import fish.payara.micro.PayaraMicroRuntime;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.logging.Level;
import java.util.logging.Logger;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
        PayaraMicroRuntime instance = PayaraMicro.bootstrap();

        try (InputStream is = new FileInputStream("/home/user/test.war")){
            instance.deploy("test", "app", is);
        }
        catch (IOException ex){
            Logger.getLogger(EmbeddedPayara.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-an-application-programmatically-from-a-maven-repository"><a class="anchor" href="#deploying-an-application-programmatically-from-a-maven-repository"></a>Deploying an Application Programmatically from a Maven Repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Payara Micro supports the deployment of an application&#8217;s artefact that is hosted in a Maven repository.</p>
</div>
<div class="sect2">
<h3 id="deploying-an-artefact-using-maven-coordinates"><a class="anchor" href="#deploying-an-artefact-using-maven-coordinates"></a>Deploying an Artefact Using Maven Coordinates</h3>
<div class="paragraph">
<p>To deploy an application directly from a Maven repository, you will need to add a Maven GAV coordinate. This can be done using <code>addDeployFromGAV()</code> method. This method accepts a comma separated string denoting a maven artefact&#8217;s <code>groupId</code>, <code>artifactId</code>, and <code>version</code> attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.PayaraMicro;
import fish.payara.micro.BootstrapException;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
       PayaraMicro.getInstance().addDeployFromGAV("fish.payara.testing,clusterjsp, 1.1").bootStrap();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="specifying-additional-maven-repositories"><a class="anchor" href="#specifying-additional-maven-repositories"></a>Specifying Additional Maven Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Payara Micro will only search for artefacts in the Maven Central repository. If you wish to search additional repositories, you can add them to the list of repositories to search with the <code>addRepoUrl()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.PayaraMicro;
import fish.payara.micro.BootstrapException;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
       PayaraMicro.getInstance().addRepoUrl("https://raw.github.com/Pandrex247/Payara_PatchedProjects/Payara-Maven-Deployer");
       PayaraMicro.getInstance().addDeployFromGAV("fish.payara.testing,clusterjsp,1.1").bootStrap();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To search through multiple additional repositories, you can simply call the <code>addRepoUrl</code> method, and specify a comma-separated list of the URLs of each repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.PayaraMicro;
import fish.payara.micro.BootstrapException;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
       PayaraMicro micro = PayaraMicro.getInstance();
       micro.addRepoUrl("https://raw.github.com/Pandrex247/Payara_PatchedProjects/Payara-Maven-Deployer", "https://maven.java.net/content/repositories/promoted/");
       micro.addDeployFromGAV("fish.payara.testing,clusterjsp,1.1");
       micro.bootStrap();
    }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="deploying-multiple-applications-from-a-maven-repository"><a class="anchor" href="#deploying-multiple-applications-from-a-maven-repository"></a>Deploying Multiple Applications from a Maven Repository</h3>
<div class="paragraph">
<p>To deploy multiple applications hosted in a Maven repository, you must call the <code>addDeployFromGAV</code> method for each application.For example, to deploy two applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import fish.payara.micro.PayaraMicro;
import fish.payara.micro.BootstrapException;

public class EmbeddedPayara{
    public static void main(String[] args) throws BootstrapException{
       PayaraMicro micro = PayaraMicro.getInstance();
       micro.addDeployFromGAV("fish.payara.testing,clusterjsp,1.1");
       micro.addDeployFromGAV("fish.payara.testing,demo,1.0");
       micro.bootStrap();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../../_/js/site.js"></script>
<script async src="../../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
