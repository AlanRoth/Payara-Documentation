<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Client Certificate Custom Validations :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../../index.html">docs</a></li>
    <li><a href="Custom%20Validators.html">Client Certificate Custom Validations</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/Payara-Documentation/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Server%20Documentation/Server%20Configuration%20And%20Management/Security%20Configuration/Client%20Certificates/Custom%20Validators.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Client Certificate Custom Validations</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>By default, the Payara Server runtime checks only if the submitted Client Certificate is present in the trust store and that it hasn&#8217;t expired already. If this conditions are met, it is accepted without any additional checks.</p>
</div>
<div class="paragraph">
<p>Custom Client Certificate Validation allows you to perform extra checks in addition to checking for the presence of the certificate in the trust store.</p>
</div>
<div class="paragraph">
<p>You can perform a check on the validity date, and use the Online Certificate Status Protocol (OCSP) to validate the certificate when it has a Certificate Revocation List entry (CRL), or lookup the DN name in a database for example, and determine based on this information if the certificate is still accepted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-custom-validator"><a class="anchor" href="#create-custom-validator"></a>Creating a Custom Validator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you want to implement custom validation, implement the <code>fish.payara.security.client.ClientCertificateValidator</code> interface and define your class through the <code>ServiceLoader</code> mechanism.</p>
</div>
<div class="paragraph">
<p>To have the <code>ClientCertificateValidator</code> interface available in your application, add the <code>payara-api</code> artifact to your application with the provided scope. When using maven, add the following snippet if not already defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;fish.payara.api&lt;/groupId&gt;
    &lt;artifactId&gt;payara-api&lt;/artifactId&gt;
    &lt;version&gt;{currentVersion}&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that you have the interface available, you can implement it in your application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyCertificateValidator implements ClientCertificateValidator {

    @Override
    public boolean isValid(Subject subject, X500Principal principal, X509Certificate certificate) {
         //
         return ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most important parameter here is the <code>principal</code> parameter which contains the user information contained in the Client Certificate presented in the request. The Certificate itself is in the last parameter and in the case you like to have access already to the <code>Subject</code> for this validation, it is passed in as the first parameter.</p>
</div>
<div class="paragraph">
<p>When you return <code>true</code> as the method result, the processing of the request continues. In the case false is returned, a <code>LoginException</code> is thrown resulting in a status 401 for the request.</p>
</div>
<div class="paragraph">
<p>This class is loaded through the Java ServiceLoader mechanism. Make sure you have the following file. <em>META-INF/services/fish.payara.security.client.ClientCertificateValidator</em> containing the fully qualified name of your implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>com.company.certificate.MyCertificateValidator</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can @Inject CDI and EJB beans in your validator implementation, however since the validator itself is not a Jakarta EE bean, <code>@PostConstruct</code> and <code>@PreDestroy</code>-annotated methods will not be called on the validator instance.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client-certificate-expiration-validator"><a class="anchor" href="#client-certificate-expiration-validator"></a>Certificate Expiration Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, certificate expiration validation is enabled. This validation checks if the certificates in the trust store haven&#8217;t expired yet. If the client certificate has expired or is not valid yet, a warning message will be printed in the server logs.</p>
</div>
<div class="sect2">
<h3 id="using-the-asadmin-cli"><a class="anchor" href="#using-the-asadmin-cli"></a>Using the Asadmin CLI</h3>
<div class="paragraph">
<p>You can use the following asadmin command to set the value of the property through:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set configs.config.${YOUR_INSTANCE_CONFIG}.security-service.auth-realm.certificate.property.certificate-validation=[true/false]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-admin-console"><a class="anchor" href="#using-the-admin-console"></a>Using the Admin Console</h3>
<div class="paragraph">
<p>This feature can be configured on the default certificate realm as follows on the Admin Console:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the applicable configuration page for your use (e.g. <code>server-config</code>) under the <code>Configurations</code> option in the side menu</p>
</li>
<li>
<p>Head to <code>Security</code> &#8594; <code>Realms</code> and select the <code>certificate</code> realm</p>
</li>
<li>
<p>Set the property <code>certificate-validation</code> <em>value</em> to <code>[true/false]</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../../_images/security/default-certificate-expiration-validation.png" alt="Certificate Expiration Validation Setting"></span></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
After setting the value of the property, make sure that you <strong>restart the server instance</strong> for the changes to take effect.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../../_/js/site.js"></script>
<script async src="../../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
