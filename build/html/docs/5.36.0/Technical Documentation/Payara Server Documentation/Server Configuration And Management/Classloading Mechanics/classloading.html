<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Enhanced Classloading :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">docs</a></li>
    <li><a href="classloading.html">Enhanced Classloading</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/ondro-poc/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Server%20Documentation/Server%20Configuration%20And%20Management/Classloading%20Mechanics/classloading.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Enhanced Classloading</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page covers the enhanced class loading functionality provided by Payara Server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="default-class-and-library-loading"><a class="anchor" href="#default-class-and-library-loading"></a>Default Class and Library Loading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Payara Server has included many standard Java libraries and packages, for example <strong>Jackson</strong>, <strong>Nimbus JOSE</strong>, <strong>Logback</strong>, and others to use. These libraries are located on the <code>${PAYARA_INSTALL_DIR}/modules</code> directory.</p>
</div>
<div class="paragraph">
<p>The default class loading mechanism of Payara Server works like this: When loading classes that belong to a library or framework that is included in the server, the server <strong>will always</strong> load those classes even if the application itself includes different versions.</p>
</div>
<div class="paragraph">
<p>In some cases, application developers will want to include a different version of the libraries that are already included on the server. Common use cases for this are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use a newer version of a library that is included in the server. For example, Payara Server includes the Jackson library, and you might need to use a newer version that includes a specific feature you want to use.</p>
</li>
<li>
<p>Use an older version of a library included within the server in order to support legacy applications. For example, you are using an older version of <strong>Icefaces</strong> that depends on an older version of JSF.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Unfortunately, due to the way the default class loading works, this will not be possible, and all libraries included with the server libraries will take precedence.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disable-classloading-delegation"><a class="anchor" href="#disable-classloading-delegation"></a>Disable Classloading delegation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order for the server&#8217;s classloader to load classes from libraries of different versions to the ones shipped with it, it&#8217;s possible to disable the <strong>default classloader delegation</strong>. It can be altered to allow the server to load classes from libraries located at different sources in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Libraries on WAR applications (included on <em>WEB-INF/lib</em>)</p>
</li>
<li>
<p>Libraries on EAR applications (included on <em>/lib</em>)</p>
</li>
<li>
<p>Libraries from the domain (located at <code>${DOMAIN_DIR}/lib</code>)</p>
</li>
<li>
<p>Libraries from the server (located at <code>${PAYARA_INSTALL_DIR}</code>/modules_)</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="disable-classloading-delegation-globally"><a class="anchor" href="#disable-classloading-delegation-globally"></a>Disable Classloading delegation globally</h3>
<div class="paragraph">
<p>To disable class loading delegation globally, you can set the system property <code>fish.payara.classloading.delegate</code> to <code>false</code>. This way, any library that is included on deployed applications will override the ones that are included in the server.</p>
</div>
<div class="paragraph">
<p>Libraries included at the domain level (<code>${DOMAIN_DIR}/lib</code>) will take precedence over the libraries included at the server.</p>
</div>
</div>
<div class="sect2">
<h3 id="disable-classloading-delegation-locally"><a class="anchor" href="#disable-classloading-delegation-locally"></a>Disable Classloading delegation locally</h3>
<div class="paragraph">
<p>It&#8217;s possible to disable class loading delegation directly at the application level. This can be done for both WAR and EAR applications.</p>
</div>
<div class="sect3">
<h4 id="on-war-applications"><a class="anchor" href="#on-war-applications"></a>On WAR Applications</h4>
<div class="paragraph">
<p>For <strong>WAR</strong> applications, you can include <code>&lt;class-loader delegate="false"/&gt;</code> element in the <code>glassfish-web.xml</code> deployment descriptor. Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE glassfish-web-app PUBLIC "-//GlassFish.org//DTD GlassFish Application Server 3.1 Servlet 3.0//EN" "http://glassfish.org/dtds/glassfish-web-app_3_0-1.dtd"&gt;
&lt;glassfish-web-app error-url=""&gt;
  &lt;class-loader delegate="false"/&gt;
&lt;/glassfish-web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this, all libraries included on the <code>WEB-INF/lib/</code> directory will take precedence.</p>
</div>
</div>
<div class="sect3">
<h4 id="on-ear-applications"><a class="anchor" href="#on-ear-applications"></a>On EAR Applications</h4>
<div class="paragraph">
<p>For <strong>EAR</strong> applications, you can include the <code>&lt;classloading-delegate&gt;false&lt;/classloading-delegate&gt;</code> element in the <code>glassfish-application.xml</code> deployment descriptor. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE glassfish-application PUBLIC "-//GlassFish.org//DTD GlassFish Application Server 3.1 Java EE Application 6.0//EN" "http://glassfish.org/dtds/glassfish-application_6_0-1.dtd"&gt;
&lt;glassfish-application&gt;
    &lt;classloading-delegate&gt;false&lt;/classloading-delegate&gt;
&lt;/glassfish-application&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this, all libraries included on the EAR&#8217;s <code>lib/</code> directory will take precedence.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-bundled-jsf"><a class="anchor" href="#use-bundled-jsf"></a>Use other JSF implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to make the server use the bundled JSF implementation within the application, you need to set an additional configuration parameter; class loading delegation alone is not enough.
You need to indicate within the <em>payara-web.xml</em> (or glassfish-web.xml) file that the server should use the bundled JSF implementation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE payara-web-app PUBLIC "-//Payara.fish//DTD Payara Server 4 Servlet 3.0//EN" "{payaraWebDtd}"&gt;
&lt;payara-web-app error-url=""&gt;
    &lt;class-loader delegate="false"/&gt;
    &lt;property name="useBundledJsf" value="true" /&gt;
&lt;/payara-web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By specifying these options, the bundled JSF implementation within your deployment (WAR or EAR) will be used correctly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extreme-classloading-isolation"><a class="anchor" href="#extreme-classloading-isolation"></a>Extreme Classloading Isolation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s possible to configure an extreme isolation level on the class loading delegation for deployed applications. With this extreme isolation behavior, a deployed application can force the server to load only classes and resources from libraries included on Payara Server Community that belong to <strong>whitelisted packages</strong> defined on its deployment descriptors.</p>
</div>
<div class="paragraph">
<p>To configure whitelist packaging you can use the <code>&lt;whitelist-package&gt;</code> element on the <em>glassfish-web.xml</em> (WAR artifacts) or the <em>glassfish-application.xml</em> (EAR artifacts). This element can be included multiple times to whitelist multiple packages. Here is an example of whitelisting both the <strong>Google Guava</strong>, <strong>Jackson</strong> and <strong>Faces Config</strong> packages for a WAR application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE glassfish-web-app PUBLIC "-//GlassFish.org//DTD GlassFish Application Server 3.1 Servlet 3.0//EN" "http://glassfish.org/dtds/glassfish-web-app_3_0-1.dtd"&gt;
&lt;glassfish-web-app error-url=""&gt;
  &lt;whitelist-package&gt;com.google.guava&lt;/whitelist-package&gt;
  &lt;whitelist-package&gt;com.fasterxml.jackson&lt;/whitelist-package&gt;
  &lt;whitelist-package&gt;com.sun.faces.spi.FacesConfigResourceProvider&lt;/whitelist-package&gt;
&lt;/glassfish-web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The whitelist syntax is simple: Define the name of the package which contains the classes or resources in question. For example writing <code>com.google</code> would whitelist all Google libraries included on the server, while writing <code>com.google.guava</code> would only whitelist the Google Guava library instead.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To enable this extreme isolation behavior, at least one <code>whitelist-package</code> element must be defined in the appropriate descriptor.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="default-whitelisted-classes"><a class="anchor" href="#default-whitelisted-classes"></a>Default Whitelisted Classes</h3>
<div class="paragraph">
<p>Certain classes are whitelisted automatically, meaning they will always be loaded from Payara Server&#8217;s libraries, even if this feature is turned on.</p>
</div>
<div class="paragraph">
<p>This is because these packages are required by Payara Server and therefore cannot be loaded from a deployed application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java</code></p>
</li>
<li>
<p><code>javax</code></p>
</li>
<li>
<p><code>com.sun</code></p>
</li>
<li>
<p><code>org.glassfish</code></p>
</li>
<li>
<p><code>org.apache.jasper</code></p>
</li>
<li>
<p><code>fish.payara</code></p>
</li>
<li>
<p><code>com.ibm.jbatch</code></p>
</li>
<li>
<p><code>org.hibernate.validator</code></p>
</li>
<li>
<p><code>org.jboss.weld</code></p>
</li>
<li>
<p><code>com.ctc.wstx</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Default whitelisted resources are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>META-INF/services/javax.</code></p>
</li>
<li>
<p><code>META-INF/services/org.glassfish.</code></p>
</li>
<li>
<p><code>META-INF/services/java.</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
