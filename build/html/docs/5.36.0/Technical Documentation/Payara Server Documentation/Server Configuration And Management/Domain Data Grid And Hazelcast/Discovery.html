<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Domain Data Grid Discovery Modes :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">docs</a></li>
    <li><a href="Discovery.html">Domain Data Grid Discovery Modes</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/Payara-Documentation/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Server%20Documentation/Server%20Configuration%20And%20Management/Domain%20Data%20Grid%20And%20Hazelcast/Discovery.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Domain Data Grid Discovery Modes</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Domain Data Grid has the concept of auto-discovery. When a Payara Server or Payara Micro instance starts it must discover other Data Grid nodes so that it can join the grid. Once an instance has connected to a Payara Instance that is already a member of the grid then it can become a member of the grid.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modes"><a class="anchor" href="#modes"></a>Discovery Modes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the discovery mechanisms or modes that are included by default in Payara Server.</p>
</div>
<div class="sect2">
<h3 id="domain"><a class="anchor" href="#domain"></a>Domain Discovery Mode</h3>
<div class="paragraph">
<p>The Domain discovery mode is the default discovery mode in Payara Server. In this mode when a Payara Server instance starts it uses information encoded into the <code>domain.xml</code> describing the node IP Address and ports of the other servers in the domain and the DAS to connect to an existing member of the Data Grid. For a Payara Server instance the first server it will try to connect to is the DAS if that fails it will then try each of the other instances in turn. When the DAS starts it tries to connect to each instance in turn.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As the <code>domain.xml</code> is used to discover other members of the Data Grid no further user configuration is usually necessary.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tcp-ip"><a class="anchor" href="#tcp-ip"></a>TCP-IP Discovery Mode</h3>
<div class="paragraph">
<p>The TCP-IP discovery mode is an alternative discovery mode. In this mode the user specifies a comma separated list of IP addresses and ports that a Payara Server instance should try to find members of the data grid at upon boot.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This discovery mode can be used to build a topology based on single instances of the DAS joining together to create the Data Grid. This is common in container based topologies with no central domain administration server.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="multicast"><a class="anchor" href="#multicast"></a>Multicast Discovery Mode</h3>
<div class="paragraph">
<p>The Multicast discovery mode is an alternative discovery mode. In this mode the user specifies the multicast group and multicast port used to find other members of the Data Grid. When a Payara Server Community instance configured with multicast discovery starts it broadcasts a message on the multicast group and port to discover other members of the data grid.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This discovery mode can be used to also build a topology based on single instances of the DAS joining together to create the data grid. In this mode multicast must be supported on the network.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This mode is the default mode for Payara Micro
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Also change the Data Grid group name and password to prevent other instances on the same LAN inadvertently joining your data grid.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dns"><a class="anchor" href="#dns"></a>DNS Discovery Mode</h3>
<div class="paragraph">
<p>The DNS discovery mode is an alternative discovery mode, closely related to the TCPIP discovery mode. In this mode the user specifies a comma separated list of DNS names and ports that a Payara Server should try to find members of the data grid at upon boot.</p>
</div>
</div>
<div class="sect2">
<h3 id="kubernetes"><a class="anchor" href="#kubernetes"></a>Kubernetes Discovery Mode</h3>
<div class="paragraph">
<p>The Kubernetes discovery mode is an alternative discovery mode intended for use when running in a Kubernetes environment. In this mode, the user specifies the Kubernetes service name and namespace that Payara Server should look to find other data grid members in - Payara Server will then contact the Kubernetes master upon boot to obtain the list of IP addresses of any other running instances under the specified namespace and service name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This clustering is done using the Hazelcast Kubernetes plugin, and so you will need to grant Hazelcast permission to query the Kubernetes master node. As per the plugin documentation, you will need to apply the permissions outlined below using <code>kubectl apply</code>. The original documentation on configuring these permissions can be found <a href="https://github.com/hazelcast/hazelcast-kubernetes#grating-permissions-to-use-kubernetes-api">here</a>, as well as extra documentation on how to restrict these permissions further <a href="https://github.com/helm/charts/tree/master/stable/hazelcast#configuration">here</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: default-cluster
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: view
subjects:
- kind: ServiceAccount
  name: default
  namespace: default</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-admin-console"><a class="anchor" href="#configuration-admin-console"></a>Configuration in the Administration Console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The domain discovery mode can be configured in the administration console under the <strong>Data Grid</strong> menu option. The discovery mode that is set gets to  be applied in a domain-wide manner.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/domain-datagrid/discovery-mode.png" alt="Domain Discovery Mode"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-asadmin-cli"><a class="anchor" href="#configuration-asadmin-cli"></a>Configuration via Asadmin CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The discovery mode can be set via the asadmin CLI, depending on the specific mode to be selected, by running the following commands</p>
</div>
<div class="sect2">
<h3 id="set-tcpip-mode"><a class="anchor" href="#set-tcpip-mode"></a>Set TCPIP Mode</h3>
<div class="paragraph">
<p>When setting TCPIP mode the list of IP addresses and ports of all Data Grid members must be specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set-hazelcast-configuration --clustermode tcpip --tcpipmembers 192.168.0.104:4900,192.168.0.105:5900</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set-domain-mode"><a class="anchor" href="#set-domain-mode"></a>Set Domain Mode</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set-hazelcast-configuration --clustermode domain</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set-multicast-mode"><a class="anchor" href="#set-multicast-mode"></a>Set Multicast Mode</h3>
<div class="paragraph">
<p>When setting multicast mode the multicast group and multicast port must be also specified.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If these settings are not specified they will default to <code>224.2.2.3</code> and <code>54327</code>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set-hazelcast-configuration --clustermode multicast --multicastgroup 224.2.2.4 --multicastport 55000</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set-dns-mode"><a class="anchor" href="#set-dns-mode"></a>Set DNS Mode</h3>
<div class="paragraph">
<p>When setting DNS mode the list of DNS names and ports of all Data Grid members must be specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set-hazelcast-configuration --clustermode dns --dnsmembers localhost:4900,www.example.com:5900</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set-kubernetes-mode"><a class="anchor" href="#set-kubernetes-mode"></a>Set Kubernetes Mode</h3>
<div class="paragraph">
<p>When setting Kubernetes mode the service name and namespace must be specified using the <code>--kubernetesservicename</code> and <code>--kubernetesnamespace</code> options respectively.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a namespace is not specified, Payara Server will use the "default" namespace.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set-hazelcast-configuration --clustermode kubernetes --kubernetesServiceName payara --kubernetesNamespace default</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
