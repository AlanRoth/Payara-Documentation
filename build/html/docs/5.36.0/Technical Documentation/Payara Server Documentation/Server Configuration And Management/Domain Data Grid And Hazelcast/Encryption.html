<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data Grid Encryption :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">docs</a></li>
    <li><a href="Encryption.html">Data Grid Encryption</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/Payara-Documentation/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Server%20Documentation/Server%20Configuration%20And%20Management/Domain%20Data%20Grid%20And%20Hazelcast/Encryption.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Data Grid Encryption</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Encryption of the data stored within the data grid of Hazelcast has previously required a <strong>Hazelcast Enterprise</strong> subscription. While this remains an option for those who would like the additional features it provides (such as WAN replication), Payara Server now includes its own encryption implementation that provides this feature to you without an additional subscription.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="encryption-mechanism"><a class="anchor" href="#encryption-mechanism"></a>Encryption Mechanism</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This feature provides encryption of the data that’s being stored in-memory via the Hazelcast data grid, providing end-to-end encryption of the data across all instances in the domain. End-to-end encryption is encryption of data both at rest (in storage) and in transit (during communication).</p>
</div>
<div class="paragraph">
<p>Payara Server uses a symmetric key to perform the encryption of the data within the data grid store. This means that the same key is used by each member of the data grid to encrypt and decrypt the data.</p>
</div>
<div class="paragraph">
<p>This key is generated and protected using the master password and a key derivation function. The key itself is a 256-bit AES key, utilising an initialisation vector and a salt for each call of encryption to help prevent any statistical pattern recognition.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="encryption-targets"><a class="anchor" href="#encryption-targets"></a>Encryption Targets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following data stores are encrypted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web Session Persistence</p>
</li>
<li>
<p>Stateful Session Bean Persistence</p>
</li>
<li>
<p>Request Traces</p>
</li>
<li>
<p>Historic Health Checks</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup"><a class="anchor" href="#setup"></a>Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section details the necessary steps to set up and enable encryption of the data grid and the various data stores.</p>
</div>
<div class="paragraph">
<p>Documentation around configuration of the data sources for encryption assumes that you&#8217;ve already generated the encryption key and enabled encryption of the data grid.</p>
</div>
<div class="sect2">
<h3 id="generating-an-encryption-key"><a class="anchor" href="#generating-an-encryption-key"></a>Generating an Encryption Key</h3>
<div class="paragraph">
<p>The key to be used by Payara Server Community to perform the actual encryption and decryption of data can be generated using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin &gt; generate-encryption-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command generates a key using the master password – the same one used to access the key store used by Payara Server.
Similar to the <code>change-master-password</code> command, this command requires you to shut down the DAS first.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This command should only be run on the DAS since this is the <em>master</em> instance, and will be the
instance propagating the key out to other instances in the domain.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default value for the master password is <code>changeit</code>. You can also provide the master password via a password file
like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin -W /path/to/passwordfile.txt generate-encryption-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>That will generate a new file with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">AS_ADMIN_MASTERPASSWORD=changeit</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you change the master password after generating your key, you’ll need to regenerate and propagate the new key to each of your instances since the original key was created using the old (and now incorrect) password. This should occur under the default <code>--sync normal</code>, but <code>--sync full</code> can be used to delete the local copy and resync.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="enabling-encryption-in-hazelcast"><a class="anchor" href="#enabling-encryption-in-hazelcast"></a>Enabling Encryption in Hazelcast</h3>
<div class="paragraph">
<p>Enabling encryption of the data grid itself is controlled by the <code>set-hazelcast-configuration</code> asadmin command, with the <code>--encryptdatagrid</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin set-hazelcast-configuration --encryptdatagrid true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a domain-wide setting, and thus means that hybrid setups where encryption is enabled only on specific clusters within a domain is not supported.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Once you’ve generated your key and enabled encryption, you must restart all instances in the domain if they were still running; changes in encryption settings do not take effect until a server is restarted. It is <strong>highly</strong> recommended that you restart all of your running instances as quickly as possible, since those that haven&#8217;t been restarted will be unable to decrypt the encrypted data placed in the data grid store by those that have been.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="web-session-availability-configuration"><a class="anchor" href="#web-session-availability-configuration"></a>Web Session Availability Configuration</h3>
<div class="paragraph">
<p>Encrypting web session availability data requires no extra actions on top of configuring the Web Container Availability Persistence Type to <em>hazelcast</em> (which it is by default).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin set configs.config.server-config.availability-service.web-container-availability.persistence-type=hazelcast</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stateful-session-bean-availiability-configuration"><a class="anchor" href="#stateful-session-bean-availiability-configuration"></a>Stateful Session Bean Configuration</h3>
<div class="paragraph">
<p>Encrypting stateful session bean (SFSB) availability data requires no extra actions on top of configuring the EJB Container Availability HA and/or SFSB Persistence Type to <code>hazelcast</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin set configs.config.server-config.availability-service.ejb-container-availability.sfsb-ha-persistence-type=hazelcast
asadmin set configs.config.server-config.availability-service.ejb-container-availability.sfsb-persistence-type=hazelcast</code></pre>
</div>
</div>
<div class="paragraph">
<p>[[Request Tracing Service-configuration]]
=== Request Tracing Configuration</p>
</div>
<div class="paragraph">
<p>No additional actions necessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="healthcheck-configuration"><a class="anchor" href="#healthcheck-configuration"></a>HealthCheck Configuration</h3>
<div class="paragraph">
<p>No additional actions necessary.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
