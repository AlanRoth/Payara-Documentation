<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker Nodes :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">docs</a></li>
    <li><a href="Docker%20Nodes.html">Docker Nodes</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/Payara-Documentation/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Server%20Documentation/Server%20Configuration%20And%20Management/Docker%20Host%20Support/Docker%20Nodes.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Docker Nodes</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A Docker node is similar to the existing SSH, DCOM, and CONFIG nodes in that
it is a virtual representation of a Payara Server installation, providing connection
details that the Domain Administration Server (DAS) uses to communicate with the
installation to create, stop, start, and delete instances. Where it
differs from these existing node types is that instances created against it are actually housed in Docker containers,
and so also contains details on how to communicate with the
Docker engine of the remote machine.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The Docker engine must expose its REST admin service on an HTTP port
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exposing-the-docker-rest-admin-service"><a class="anchor" href="#exposing-the-docker-rest-admin-service"></a>Exposing the Docker REST Admin Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To expose the REST admin service of the Docker engine, you need to specify the <code>-H</code> option in your <code>DOCKER_OPTS</code> environment
variable, or otherwise specify it in the command that starts the docker service.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">DOCKER_OPTS="-H=0.0.0.0:2376"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can test that it is exposed by navigating to it with your browser (assuming you&#8217;re exposing the port in the example above): <a href="http://localhost:2376/info" class="bare">http://localhost:2376/info</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-node"><a class="anchor" href="#creating-a-node"></a>Creating a Docker Node</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating a Docker node is done in a similar manner to creating an SSH or CONFIG
node, either by asadmin command, or by the Nodes page of the admin console.</p>
</div>
<div class="paragraph">
<p>Docker nodes do have some unique configuration properties however:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker Password File - This is the fully-qualified path of the password file that the Docker instance will use for
authentication against the DAS. Please note, that this path should be the path to the file on the <strong>remote</strong> machine.
This file should be a standard Payara password file as you would use with asadmin. This must be specified, as Docker
instances require secure admin to be enabled to start.</p>
</li>
<li>
<p>TLS - Whether or not to use HTTPS to communicate with the Docker engine or not.</p>
</li>
<li>
<p>Docker Port - The port that the Docker engine is listening on. Defaults to 2376.</p>
</li>
<li>
<p>Docker Image - The Docker image to use. Payara Server will default to using the
<em>payara/payaraserver-node:{currentVersion}</em> image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The configuration options of CONFIG nodes are also available, namely <em>nodehost</em>, <em>nodedir</em>, and <em>installdir</em>. Specifying
the <em>nodehost</em> option remains mandatory, but for docker nodes the <em>installdir</em> and <em>nodedir</em> options can safely be left as
their defaults unless you&#8217;re specifying your own Docker image.</p>
</div>
<div class="paragraph">
<p>Please take particular note of the <em>Docker Password File</em> option: this is mandatory and <strong>must be present on the remote machine</strong>.
Payara Server Community does not currently support propagating password files from the DAS to your remote machines.
Secure admin must also be enabled for Docker Nodes to function correctly, which entails setting an admin password.
See below for an example of enabling secure admin for the default <em>admin</em> user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">&gt;asadmin change-admin-password --user admin
Enter the admin password&gt;
Enter the new admin password&gt;
Enter the new admin password again&gt;
Command change-admin-password executed successfully.

&gt;asadmin enable-secure-admin
Authentication failed with password from login store
Enter admin password for user "admin"&gt;
You must restart all running servers for the change in secure admin to take effect.
Command enable-secure-admin executed successfully.

&gt;asadmin restart-domain</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example of an extremely simple password file, here is the contents of a sample, passwordfile.txt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">AS_ADMIN_PASSWORD=changeit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where "<em>changeit</em>" is the password of the default <em>admin</em> user.</p>
</div>
<div class="paragraph">
<p>Once you have ensured that you have secure admin enabled, and that a passwordfile granting access to the
DAS is present on the remote machine, you can run the asadmin command for creating a Docker node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin create-node-docker --nodehost localhost --dockerPasswordFile /opt/passwordfile.txt --dockerport 2376 DockerInstance1</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The admin console page for creating Docker nodes is the same as creating the other node types: simply
select <em>DOCKER</em> as the node type from the dropdown.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-tls"><a class="anchor" href="#configuring-tls"></a>Configuring TLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As Docker must expose an HTTP port, it is recommended that it be protected using TLS outside of development environments.</p>
</div>
<div class="paragraph">
<p>A full guide for how to do so can be found here: <a href="https://docs.docker.com/engine/security/https/" class="bare">https://docs.docker.com/engine/security/https/</a>
In short, create self-signed TLS certificates (or use your own signed ones), and add them to your DOCKER_OPTS to
secure the Docker REST admin service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">DOCKER_OPTS="--tlsverify --tlscacert=/home/anon/tls/ca.pem --tlscert=/home/anon/tls/server-cert.pem --tlskey=/home/anon/tls/server-key.pem -H=0.0.0.0:2376"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming you followed this guide, you will need to perform the following steps to allow Payara Server to communicate
with the Docker engine:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the CA certificate into the Domain truststore (defaults to
<em>${payaraHome}/glassfish/domains/${domainName}/config/cacerts.jks</em>)</p>
</li>
<li>
<p>Create a PKCS12 bundle from the client certificate and key</p>
</li>
<li>
<p>Import the generated PKCS12 bundle into the Domain&#8217;s keystore (defaults to
<em>${payaraHome}/glassfish/domains/${domainName}/config/keystore.jks</em>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once you&#8217;ve enabled TLS for the Docker REST admin service and added the necessary certificates
&amp; keys to Payara Server, you can create a Docker Node with TLS enabled like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin create-node-docker --nodehost localhost --useTls true --dockerPasswordFile /opt/passwordfile.txt --dockerport 2376 DockerInstance1</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Please ensure that the <em>useTLS</em> option of the node matches whether or not you have configured TLS for the Docker
engine, as otherwise any communication with the Docker engine will fail.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
