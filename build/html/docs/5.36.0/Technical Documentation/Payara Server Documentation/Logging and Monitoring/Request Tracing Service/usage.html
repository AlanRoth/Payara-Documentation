<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">docs</a></li>
    <li><a href="usage.html">Usage</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/ondro-poc/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Server%20Documentation/Logging%20and%20Monitoring/Request%20Tracing%20Service/usage.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Usage</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Tracing in the Payara Platform is done either automatically, or by using using the MicroProfile OpenTracing <code>@Traced</code>
annotation. This section covers manually decorating your applications for tracing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-traced-annotation"><a class="anchor" href="#using-the-traced-annotation"></a>Using the <code>@Traced</code> Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>@Traced</code> annotation can be placed on CDI Bean methods to automatically trace each call
of the method. You can also place the annotation on the class itself to trace all methods
within the class, rather than adding the annotation to each method individually.</p>
</div>
<div class="paragraph">
<p>The <code>@Traced</code> annotation accepts two optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>operationName</code> - defines the operation name of the span. If left blank it will default to the
canonical method signature.</p>
</li>
<li>
<p><code>value</code> - a boolean true or false to determine if the method should be traced. Defaults to true.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequestScoped
public class TracedExample {

    @Traced
    public String method1() {
        return "anon1";
    }

    @Traced(operationName = "tracingTest")
    public String method2() {
        return "anon2";
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Traced</code> the annotation operates as an Interceptor, so for the decorated methods of
your CDI Beans to be traced they need to be a) not static or private, and b) accessed externally
or via self-injection. This means that in the following example, <code>method1</code> of the above class
would be traced, and <code>method2</code> would not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/")
@RequestScoped
public class JaxrsEndpoints {

    @Inject
    TracedExample tracedExample;

    @GET
    public String method1Traced() {
        return tracedExample.method1();
    }

    @GET
    public String method2NotTraced() {
        return new TracedExample().method2();
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Annotations applied to methods take precedence over those applied to classes. This allows you to
whitelist or blacklist methods for tracing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The dependency to add to your application to get access to the <code>@Traced</code> annotation is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.eclipse.microprofile.opentracing&lt;/groupId&gt;
    &lt;artifactId&gt;microprofile-opentracing-api&lt;/artifactId&gt;
    &lt;version&gt;1.3.1&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-tracer-class"><a class="anchor" href="#using-the-tracer-class"></a>Using the <code>Tracer</code> Class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Tracer</code> class allows you to manually start, finish, and add information to Spans.
To access the tracer in your applications, you can inject it like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
Tracer tracer;</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
You can only inject a Tracer when your application is running inside a Payara Platform runtime
- you cannot do so from a Java SE client. From a Java SE client you must use the OpenTracing.io
<code>GlobalTracer</code>, see
<a href="#/documentation/payara-server/request-tracing-service/tracing-remote-ejbs.adoc#getting-a-tracer" class="page unresolved">here</a>
for more details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Starting a Span, marking it as the active Span (the one from which any children will spawn), and ending
it is done like so with a <em>try-with-resources</em> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void tracerExample() {
    try (Span span = tracer.buildSpan("example").startActive(true)) {
        // Code to trace
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to add any Tags or Logs to your Spans, even those started by the <code>@Traced</code> annotation,
you can do this like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GET
@Path
@Traced
public String example2() {
    tracer.activeSpan().setTag("exampleTag", "foo").log("exampleLog");
    return "anon";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Tracer</code> class also gives you access to the <code>inject</code> and <code>extract</code> methods, which you can use for tracing
across threads and processes. It is recommended however that you simply use a Managed Executor
Service for your asynchronous tasks and the default JAX-RS client implementation or MicroProfile REST Client for
JAX-RS calls as these will automatically do this for you.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disabling-automatic-tracing"><a class="anchor" href="#disabling-automatic-tracing"></a>Disabling Automatic Tracing of JAX-RS Methods and MicroProfile REST Client Calls</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, calls to JAX-RS methods and any calls by a MicroProfile REST Client are traced.</p>
</div>
<div class="sect2">
<h3 id="disabling-jaxrs-tracing"><a class="anchor" href="#disabling-jaxrs-tracing"></a>Disabling Automatic Tracing of JAX-RS Methods</h3>
<div class="paragraph">
<p>To disable tracing of JAX-RS methods, you can use the <code>@Traced</code> annotation on each method or class
that you wish to skip tracing of.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/")
@RequestScoped
public class JaxrsEndpoints {

    @Inject
    TracedExample tracedExample;

    // Automatically traced
    @GET
    public String method1Traced() {
        return tracedExample.method1();
    }

    // Tracing disabled
    @GET
    @Traced(false)
    public String method2NotTraced() {
        return new TracedExample().method2();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use tracing of JAX-RS methods by defining a skip pattern using a
MicroProfile Config properties file or config source. These skip patterns accept Java regular
expressions to match against the URI of your JAX-RS methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mp.opentracing.server.skip-pattern=/foo|/bar.*</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disabling-microprofile-rest-client-tracing"><a class="anchor" href="#disabling-microprofile-rest-client-tracing"></a>Disabling Automatic Tracing of MicroProfile REST Client</h3>
<div class="paragraph">
<p>To disable tracing of MicroProfile REST Client calls, annotate the client interface or method with
<code>@Traced(false)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Traced(false)
@Path("/")
public interface ExampleClient {

    @GET
    @Path("test")
    @Produces(MediaType.TEXT_PLAIN)
    Response example();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
