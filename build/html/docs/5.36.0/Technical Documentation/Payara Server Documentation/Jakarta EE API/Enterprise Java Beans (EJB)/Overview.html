<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EJB Container Enhancements :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">docs</a></li>
    <li><a href="Overview.html">EJB Container Enhancements</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/ondro-poc/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Server%20Documentation/Jakarta%20EE%20API/Enterprise%20Java%20Beans%20(EJB)/Overview.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">EJB Container Enhancements</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section details several improvements and enhancements done to features provided by the EJB container.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concurrent-instance-configuration"><a class="anchor" href="#concurrent-instance-configuration"></a>Concurrent Instance Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Payara Server can control the number of maximum <strong>concurrent</strong> instances per EJB that can be served to its clients.</p>
</div>
<div class="paragraph">
<p>It is possible to limit the number of concurrent Stateless EJB instances that are dispatched, allowing fine-grained control of resources, limiting surface area for DDOS attacks and making applications run more smoothly and efficiently. This is done regardless of the maximum number of instances available in a bean&#8217;s pool. Using these boundaries, it is possible to instruct the EJB container so that the maximum number of threads is not exceeded at runtime.</p>
</div>
<div class="paragraph">
<p>These limits can be controlled on a per-EJB basis, using <code>bean-pool</code> elements in the <code>glassfish-ejb-jar.xml</code> deployment descriptor file with the use of the following proprietary Payara Platform tags and elements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. <code>bean-pool</code> elements in <code>glassfish-ejb-jar.xml</code></caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Behaviour</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;max-pool-size&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This element controls the maximum concurrent instances that are dispatched for this EJB (number of threads). The default is configured in the domain</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;max-wait-time-in-millis&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This element controls what to do when the number of requests exceeds the amount of beans available in the pool.
Possible values of this element include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-1</code> (<em>default</em>)</p>
<div class="paragraph">
<p>When the pooled number is exceeded, a new EJB instance is created, there is no upper bound in place.</p>
</div>
</li>
<li>
<p><code>0</code></p>
<div class="paragraph">
<p>When the pooled number is exceeded, the request will wait for a bean to free up in the pool. This effectively caps the number of threads that are concurrently created for the bean&#8217;s client request.</p>
</div>
</li>
<li>
<p>Between <code>1</code> - <code>MAX_INTEGER</code></p>
<div class="paragraph">
<p>When the pool number is exceeded, the request will wait for a bean to free up in the pool, up to the number of milliseconds specified here. After this time has expired, a new EJB instance is created and dispatched, thus the configured pool size acts as a soft upper bound, one that can be exceeded once the timer has expired.</p>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;steady-pool-size&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This element controls the <strong>minimum</strong> number of beans in the bean pool. This will increase performance at the expense of memory footprint.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The system property <code>fish.payara.ejb-container.max-wait-time-in-millis</code> can be set to change the default global value of <code>&lt;max-wait-time-in-millis&gt;</code> for <strong><em>all</em></strong> Stateless EJB bean pools.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Unless overridden in the deployment descriptor file, this will become the new default value and can be used to cap the upper bound of all concurrent invocations of any Stateless EJB pools.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="example"><a class="anchor" href="#example"></a>Example</h3>
<div class="paragraph">
<p>The following is a sample <code>glassfish-ejb-jar.xml</code> deployment descriptor that configures 2 EJBs with the settings mentioned beforehand.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE glassfish-ejb-jar PUBLIC "-//GlassFish.org//DTD GlassFish Application Server 3.1 EJB 3.1//EN" "http://glassfish.org/dtds/glassfish-ejb-jar_3_1-1.dtd"&gt;
&lt;glassfish-ejb-jar&gt;
  &lt;enterprise-beans&gt;
    &lt;ejb&gt;
      &lt;ejb-name&gt;PooledStatelessBean&lt;/ejb-name&gt;
      &lt;bean-pool&gt;
          &lt;max-pool-size&gt;1&lt;/max-pool-size&gt;
          &lt;max-wait-time-in-millis&gt;0&lt;/max-wait-time-in-millis&gt;
          &lt;steady-pool-size&gt;1&lt;/steady-pool-size&gt;
      &lt;/bean-pool&gt;
    &lt;/ejb&gt;
    &lt;ejb&gt;
      &lt;ejb-name&gt;PooledMDB&lt;/ejb-name&gt;
      &lt;bean-pool&gt;
          &lt;max-pool-size&gt;1&lt;/max-pool-size&gt;
          &lt;resize-quantity&gt;1&lt;/resize-quantity&gt;
      &lt;/bean-pool&gt;
    &lt;/ejb&gt;
  &lt;/enterprise-beans&gt;
&lt;/glassfish-ejb-jar&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom-ejb-jar-names"><a class="anchor" href="#custom-ejb-jar-names"></a>Customized EJB-JAR Archive Names</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to instruct Payara Server to override the name of an EJB-JAR module when it is deployed either as a standalone module or as part of an EAR application. It is also possible to instruct Payara Server to override the module and/or application&#8217;s name.</p>
</div>
<div class="sect2">
<h3 id="overwriting-module-name"><a class="anchor" href="#overwriting-module-name"></a>Overwriting the Module Name</h3>
<div class="paragraph">
<p>When deploying an EJB-JAR module on Payara Server Community, the portable JNDI names for all scanned EJBs will be generated using the name of the module as specified on the <em>ejb-jar.xml</em> deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ejb-jar xmlns = "http://java.sun.com/xml/ns/javaee"
         version = "3.1"
         xmlns:xsi = "http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation = "http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"&gt;
    &lt;module-name&gt;MODULE_NAME&lt;/module-name&gt;
&lt;/ejb-jar&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the name&#8217;s not specified in the deployment descriptor, the specification states that the module name will be the same as the JAR artifact used to deploy it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, When deploying a JAR from an IDE (like <strong>NetBeans</strong> or <strong>IntelliJ</strong>), the IDE deploys to Payara Server using the asadmin <code>deploy</code> command, with the <code>--name</code> option specified. This will force the module to have the specified name over the name defined in <em>ejb-jar.xml</em>. This is undesired because the IDE usually infers the module name from the name of the project or the JAR file and doesn&#8217;t take the correct name of the module into account.</p>
</div>
<div class="paragraph">
<p>In Payara Server, the module name defined in the deployment descriptor will be used even if it tries to be overridden using the <code>--name</code> option. This behaviour will <strong>always</strong> takes precedence.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In the case you need to overwrite the name of the module when deploying the module, use the <code>--forceName</code> command option.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="overwriting--the-application-name"><a class="anchor" href="#overwriting--the-application-name"></a>Overwriting the Application Name</h3>
<div class="paragraph">
<p>In the case of EAR artifacts, the portable JNDI names for all scanned EJBs will use the application name defined in the <em>application.xml</em> deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;application xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/application_7.xsd" version="7"&gt;
    &lt;display-name&gt;My Application&lt;/display-name&gt;
    &lt;application-name&gt;APPLICATION_NAME&lt;/application-name&gt;
    ...
&lt;/application&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the <code>--name</code> and <code>--forcename</code> deployment options to override the application name in a similar manner with what happens with EJB-JAR modules.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lite-remote-ejb"><a class="anchor" href="#lite-remote-ejb"></a>Lite Remote EJB Communication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For scenarios when communication with remote EJBs is needed across a complex network topology or when a server architecture is deployed on a cloud provider, there&#8217;s a new feature for the EJB server and client applications: A lite and thin client that can be used to communicate via HTTP(S) instead of IIOP-RMI.</p>
</div>
<div class="paragraph">
<p>Payara Server has support for classic remote EJB since its inception. Classic remote EJB uses the <strong>IIOP-RMI</strong> (Internet Inter-ORB Protocol Remote Method Invocation) protocol for transport communication and the <a href="https://omg.org/spec/SEC">CSIv2</a> (Common Secure Interoperability Protocol Version 2) protocol for security.</p>
</div>
<div class="paragraph">
<p>While feature rich, these protocols were not designed with firewalls, NAT, (private) clouds, Docker and generally the Internet in mind. For these environments the requirements of the protocol, such as establishing independent connections back from the server to the client, are too troublesome.</p>
</div>
<div class="paragraph">
<p>The <strong>IIOP-RMI/CSIv2</strong> also requires the use of multiple heavyweight client libraries. In the case of Payara Server the client library (either referenced by the <code>gf-client.jar</code> library or the <code>payara-embedded-all</code> dependency) is almost as big as the entire server as it&#8217;s essentially a special form of the ACC (Application Client Container). For this reason a much needed modernization  of the transport and security protocols was needed, and for the environments described only one protocol really works, and that is the HTTP(S) protocol.</p>
</div>
<div class="paragraph">
<p>Payara Server features an additional complimentary EJB remoting technology based on the HTTP(S) protocol while favoring the use of a thin client library that make remote applications much lighter while circumventing known challenges for the Internet and other scenarios.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
HTTP(S) for EJB Remoting in Payara Server is a completely different feature from the classic IIOP-RMI/CSIv2-based feature, and does not intend to replace the transport layer protocol used on it, rather it is implemented as an additional independent feature.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
TX Propagation and Security Propagation is <strong>not supported</strong> by EJB Remoting in Payara Server.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In the current version of this feature, not all remote EJB features are implemented yet.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="configuring-http-for-remote-ejb"><a class="anchor" href="#configuring-http-for-remote-ejb"></a>Configuring HTTP(S) for Remote EJBs</h3>
<div class="paragraph">
<p>HTTP(S) for EJB remoting in Payara Server makes use of a special web endpoint on which is located by default on the path <code>/ejb-invoker</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This endpoint is disabled out of the box and it can be enabled using the <code>set-ejb-invoker-configuration</code> asadmin command.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="set-ejb-invoker-configuration"><a class="anchor" href="#set-ejb-invoker-configuration"></a><code>set-ejb-invoker-configuration</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Usage</strong></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>asadmin set-ejb-invoker-configuration
        [--enabled=true|false]
        [--securityenabled=true|false]
        [--roles=&lt;role-list&gt;]
        [--authmoduleclass=&lt;SAM-class&gt;]
        [--authmodule=&lt;security-provider-id&gt;]
        [--realmname=&lt;realm-name&gt;]
        [--authtype=&lt;auth-type&gt;]
        [--endpoint=&lt;context-root[default:ejb-invoker]&gt;]
        [--virtualservers=&lt;virtualserver-list&gt;]
        [--target=&lt;target[default:server]&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Aim</strong></dt>
<dd>
<p>Enables or disables the endpoint that allows HTTP(S) transport based communication for remote EJBs.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="command-options"><a class="anchor" href="#command-options"></a>Command Options</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.75%;">
<col style="width: 6.25%;">
<col style="width: 62.5%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables the <code>ejb-invoker</code> application.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>securityenabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not secure access to the <code>ejb-invoker</code> endpoint is enabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If defined, the endpoint will be assigned to a list of the role specified as a comma-separated..</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">invoker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The context root used to expose the <code>ejb-invoker</code> application endpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ejb-invoker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authmoduleclass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the full qualified class name implementing <code>javax.security.auth.message.module.ServerAuthModule</code>. If defined and <code>securityenabled</code> is set to true, the HttpServlet Message security provider is created and <code>ejb-invoker</code> application secured with the configured SAM.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authmodule</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the existing message security provider id. If defined and <code>securityenabled</code> is set to true, the <code>ejb-invoker application</code> will be secured with it.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>realmname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the registered realm name. If defined and <code>securityenabled</code> it set to true, the <code>ejb-invoker</code> application will be secured with the corresponding realm that will be used for authentication.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authtype</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The instance or cluster to enable the endpoint.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtualservers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If defined, the endpoint will be assigned to a list of <strong>virtual servers</strong> specified as a comma-separated list of names. Otherwise, the endpoint will be assigned to all virtual servers available.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target configuration where the command should be run.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example"><a class="anchor" href="#example"></a>Example</h5>
<div class="paragraph">
<p>The following command will enable the endpoint on the DAS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin &gt; set-ejb-invoker-configuration --enabled=true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>set-ejb-invoker-configuration --enabled=true/false</code> commands actually deploy/undeploy an internal small WAR application that exposes the endpoint. In this version this application is shown in all overviews that show deployed applications once enabled.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="get-ejb-invoker-configuration"><a class="anchor" href="#get-ejb-invoker-configuration"></a><code>get-ejb-invoker-configuration</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Usage</strong></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>asadmin get-ejb-invoker-configuration [--target=&lt;target[default:server]&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Aim</strong></dt>
<dd>
<p>Returns the current configuration options for the <code>ejb-invoker</code> application on the targeted configuration.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="command-options-2"><a class="anchor" href="#command-options-2"></a>Command Options</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 66.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target configuration where the command should be run.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="example-1"><a class="anchor" href="#example-1"></a>Example</h5>
<div class="paragraph">
<p>The following command returns the current configuration options from the DAS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin &gt; get-ejb-invoker-configuration --target cluster1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-thin-client"><a class="anchor" href="#configuring-thin-client"></a>Configuring the Thin Client Dependency</h3>
<div class="paragraph">
<p>Client applications that wish to use HTTP(S) as the transport protocol when calling remote EJBs will have to use a <strong>special thin-client</strong> dependency. To do this, you can add the following Maven dependency to your client project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;fish.payara.extras&lt;/groupId&gt;
    &lt;artifactId&gt;ejb-http-client&lt;/artifactId&gt;
    &lt;version&gt;{currentVersion}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This artifact requires a patched version of the Jersey client which is pulled intransitive. This patched version is available within our <a href="https://github.com/payara/Payara_PatchedProjects">Payara Patched Project repository</a>.
The Maven repository definition is present in the pom.xml file of the <code>ejb-http-client</code> artifact. However, when your dependencies are managed by a private artifact repository, for example, you might need to update it to refer to the Payara Patched Project repository.</p>
</div>
<div class="paragraph">
<p>Also, we recommend having a look at the BOM feature so that versions can be defined more consistently.</p>
</div>
<div class="paragraph">
<p>Finally, the code that executes the call to the remote EJB must be modified in some manner. To obtain a type-safe proxy for any remote EJB bean, the traditional approach via JDNI is still used. An example is given below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, consider the following remote EJB interface:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Remote
public interface BeanRemote {
    String method();
}</code></pre>
</div>
</div>
</li>
<li>
<p>Second, consider a (secured) EJB that implements that interface and resides in a EJB application called "test" deployed on a Payara server instance that is listening in <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Stateless
public class Bean implements BeanRemote, Serializable {
    private static final long serialVersionUID = 1L;
    @Override
    @RolesAllowed("g1")
    public String method() {
        return "method";
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Given the above, the following client code can be used to obtain a proxy to the <code>BeanRemote</code> bean and invoke a remote method defined on it:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static javax.naming.Context.INITIAL_CONTEXT_FACTORY;
import static javax.naming.Context.PROVIDER_URL;
import java.util.Properties;
import javax.naming.Context;
import javax.naming.InitialContext;
public class RemoteEJBLiteClient{
    public static void main(String... args) throws NamingException{
        Properties environment = new Properties();
        environment.put(INITIAL_CONTEXT_FACTORY, "fish.payara.ejb.rest.client.RemoteEJBContextFactory");
        environment.put(PROVIDER_URL, "http://localhost:8080/ejb-invoker");
        InitialContext ejbRemoteContext = new InitialContext(environment);
        BeanRemote beanRemote = (BeanRemote) ejbRemoteContext.lookup("java:global/test/Bean");
        beanRemote.method() // returns "method"
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="calling-secured-bean"><a class="anchor" href="#calling-secured-bean"></a>Calling a Secured Remote EJB</h4>
<div class="paragraph">
<p>When calling a secured EJB using the <code>ejb-invoker</code> endpoint, there are some considerations in place for the client code:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the remote EJB is secured with transport confidentiality (and integrity) enabled like this:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ejb&gt;
    &lt;ejb-name&gt;Bean&lt;/ejb-name&gt;
    &lt;ior-security-config&gt;
        &lt;transport-config&gt;
            &lt;integrity&gt;REQUIRED&lt;/integrity&gt;
            &lt;confidentiality&gt;REQUIRED&lt;/confidentiality&gt;
            &lt;establish-trust-in-target&gt;SUPPORTED&lt;/establish-trust-in-target&gt;
            &lt;establish-trust-in-client&gt;SUPPORTED&lt;/establish-trust-in-client&gt;
        &lt;/transport-config&gt;
    &lt;/ior-security-config&gt;
&lt;/ejb&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, the corresponding HTTP endpoint to use would be <code><a href="https://localhost:8181/ejb-invoker" class="bare">https://localhost:8181/ejb-invoker</a></code> instead.</p>
</div>
</li>
<li>
<p>If the remote EJB also has authentication enabled (via username and password credentials) like this:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ejb&gt;
    &lt;ejb-name&gt;Bean&lt;/ejb-name&gt;
    &lt;as-context&gt;
        &lt;auth-method&gt;USERNAME_PASSWORD&lt;/auth-method&gt;
        &lt;realm&gt;default&lt;/realm&gt;
        &lt;required&gt;true&lt;/required&gt;
    &lt;/as-context&gt;
&lt;/ejb&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the credentials required to correctly authenticate the user for the call have to be specified in the JNDI context with the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javax.naming.Context.SECURITY_PRINCIPAL</code> for the username</p>
</li>
<li>
<p><code>javax.naming.Context.SECURITY_CREDENTIALS</code> for the password</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of the complete client code used to call a secured remote EJB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static javax.naming.Context.INITIAL_CONTEXT_FACTORY;
import static javax.naming.Context.PROVIDER_URL;
import static javax.naming.Context.SECURITY_CREDENTIALS;
import static javax.naming.Context.SECURITY_PRINCIPAL;
import java.util.Properties;
import javax.naming.Context;
import javax.naming.InitialContext;
public class RemoteEJBLiteClient{
    public static void main(String... args) throws NamingException{
        Properties environment = new Properties();
        environment.put(INITIAL_CONTEXT_FACTORY,"fish.payara.ejb.rest.client.RemoteEJBContextFactory");
        environment.put(PROVIDER_URL, "https://localhost:8181/ejb-invoker");
        environment.put(SECURITY_PRINCIPAL, "u1");
        environment.put(SECURITY_CREDENTIALS, "p1");
        InitialContext ejbRemoteContext = new InitialContext(environment);
        BeanRemote beanRemote = (BeanRemote) ejbRemoteContext.lookup("java:global/test/Bean");
        beanRemote.method() // returns "method"
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When accessing secured EJBs you <strong>should</strong> use only HTTPS (that means, enabling confidential transport requirements to the remote EJB), as the submitted credentials will be transferred in clear text (not encrypted, only base64 encoded), which is a security risk you should avoid in any production environment.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="jndi-customization-options"><a class="anchor" href="#jndi-customization-options"></a>JNDI Customization Options</h4>
<div class="paragraph">
<p>Under the covers the remote EJB proxy uses a JAX-RS (Jersey) REST client builder in order to establish communication with the remote server. If you want to customize and modify the parameters for this communication (timeouts, keystores, etc.) the following JNDI context properties can be used to this end:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. <code>JNDI Options for Custom HTTP(S) Communication</code></caption>
<colgroup>
<col style="width: 23.0769%;">
<col style="width: 38.4615%;">
<col style="width: 38.4616%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Behaviour</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.connectTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The connection timeout. A value of <strong>0</strong> represents that the wait is indefinite. Negative values are not allowed. Unit is microseconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Number</code> (from which it&#8217;s <code>Long</code> value is taken) or a <code>String</code> that can be converted to a <code>Long</code> value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.readTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The timeout to read a response. If the remote Payara doesn&#8217;t respond within the defined time a ProcessingException is thrown with a <code>TimeoutException</code> as its cause. A value of <strong>0</strong> represents that the wait is indefinite. Negative values are not allowed. Unit is microseconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Number</code> (from which it&#8217;s <code>Long</code> value is taken) or a <code>String</code> that can be converted to a <code>Long</code> value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.keyStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key store to be used by the proxy. The key store contains the private key as well as certificates with its associated public keys.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of <code>java.security.KeyStore</code> or a <code>String</code> representing its fully qualified classname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.trustStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The trust store to be used by the proxy. The trust store must contain the certificates that are needed to communicate with the remote Payara Server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of <code>java.security.KeyStore</code> or a <code>String</code> representing its fully qualified classname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.sslContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SSL context that will be used by the proxy for creating secured connections to the Payara remote server. This context <strong>must</strong> be fully initialized, including the trust and key managers. Should not be used in conjunction with the <code>fish.payara.keyStore</code> and/or <code>fish.payara.trustStore</code> properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of <code>javax.net.ssl.SSLContext</code> or a <code>String</code> representing its fully qualified classname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.hostnameVerifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname verifier to be used by the proxy to verify the endpoint&#8217;s hostname against the identification information of it.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of a <code>javax.net.ssl.HostnameVerifier</code> or a <code>String</code> representing its fully qualified classname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.provider.principal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The principal to be used by the proxy to access the secured endpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of a <code>String</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.provider.credentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The credentials to be used by the proxy to access the secured endpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of a <code>String</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.provider.authType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To specify the authentication type of the secured endpoint. By default <code>BASIC</code> is defined.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of a <code>String</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.requestFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To register the custom filter for the client request invoked by proxy.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of a <code>javax.ws.rs.client.ClientRequestFilter</code> or a <code>Class</code> implementing <code>javax.ws.rs.client.ClientRequestFilter</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.responseFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To register the custom filter for the client response received by proxy.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of a <code>javax.ws.rs.client.ClientResponseFilter ` or a `Class</code> implementing <code>javax.ws.rs.client.ClientResponseFilter</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.executorService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The executor service that will be used for executing asynchronous tasks. <em>(for future use)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of <code>java.util.concurrent.ExecutorService</code> or a <code>String</code> representing its fully qualified classname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.scheduledExecutorService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The executor service that will be used for executing scheduled asynchronous tasks. <em>(For future use)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of <code>java.util.concurrent.ScheduledExecutorService</code> or string representing fully qualified classname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.withConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configuration for the internal JAX-RS/Jersey REST client.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of <code>javax.ws.rs.core.Configuration</code> or a <code>String</code> representing its fully qualified classname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fish.payara.clientAdapter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of client side adapter to use for intercepting JNDI lookups (see below)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of <code>fish.payara.ejb.http.client.adapter.ClientAdapter</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The constants are also exposed as static attributes of the <code>fish.payara.ejb.rest.client.RemoteEJBContextFactory</code> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="system-properties-fallbacks"><a class="anchor" href="#system-properties-fallbacks"></a>System Properties Fallbacks</h4>
<div class="paragraph">
<p>The JNDI customization options listed above as well the environment variables defined in <code>javax.naming.Context</code> (except <code>APPLET</code>) can be set by setting a system property of the same name that will act as a fallback.
That means it will not override an environment variable that is already present but would be used in the case that it is not defined when <code>InitialContextFactory.getInitialContext</code> is invoked.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-side-adapter"><a class="anchor" href="#client-side-adapter"></a>Client side adapter</h3>
<div class="paragraph">
<p>EJB Lite connector is, in its current form, suited for invoking stateless remote EJBs.
However, if you&#8217;re using the connector with existing clients, those may depend on stateful interactions, like invoking stateful EJBs or accessing application server data sources and connection factories.
Client side adapters serve the purpose of emulating stateful behavior at the client and delegate the requests to stateful backend, when all information from the client is collected.</p>
</div>
<div class="paragraph">
<p>The API of client side adapters is prescribed by interface <code>fish.payara.ejb.http.client.adapter.ClientAdapter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ClientAdapter {
    /*
     * @param jndiName jndi name requested for lookup
     * @param remoteContext naming context for remote EJB invocation
     * @return Optional.of(proxy) if adapter provides a proxy for given name, Optional.empty() otherwise
     * @throws NamingException if downstream lookup fails, or other validation doesn't pass
     */
    Optional&lt;Object&gt; makeLocalProxy(String jndiName, Context remoteContext)
        throws NamingException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make use of the adapter, put an instance of <code>ClientAdapter</code> into JNDI context property <code>fish.payara.clientAdapter</code>. Every JNDI lookup will be  first passed to the adapter instance in such case. If adapter returns a non-empty <code>Optional</code> value, tit will be passed back to the client.</p>
</div>
<div class="sect3">
<h4 id="composing-multiple-adapters"><a class="anchor" href="#composing-multiple-adapters"></a>Composing multiple adapters</h4>
<div class="paragraph">
<p>Client side emulation might require stubbing diverse JNDI names and return types, and handling all of that in a single ClientAdapter implementation would result in not very maintainable code. Therefore the client library offers two classes that help with composition of multiple Client adapters into the parent instance to be passed to <code>RemoteEJBContextFactory</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CompositeClientAdapter</code> concatenates multiple client adapter instances, calling adapters in a defined order and returning first non-empty proxy provided by the adapters.</p>
</li>
<li>
<p><code>ClientAdapterCustomizer</code> is a decorator, that helps separate JNDI name matching from instantiation of client adapter.
Most used method of customizer is <code>matchPrefix</code>, which will only call downstream adapter when requested JNDI name matches prefix.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This prefix is stripped before invoking the downstream adapter.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="composite-client-adapter-example"><a class="anchor" href="#composite-client-adapter-example"></a>Composite Client Adapter example</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Properties props = new Properties();
props.put(Context.INITIAL_CONTEXT_FACTORY, RemoteEJBContextFactory.FACTORY_CLASS);
props.put(Context.PROVIDER_URL, "http://not.relevant/");
props.put(RemoteEJBContextFactory.CLIENT_ADAPTER,
        CompositeClientAdapter.newBuilder()
            .register(customize(new ConnectionFactoryAdapter()).matchPrefix("jms/")
                    customize(QueueAdapter.class).matchPrefix("queue/"))
            .build()
        );
Context context = new InitialContext(props);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://javadoc.io/doc/fish.payara.extras/ejb-http-client">API documentation</a> of the client library for detailed description of <code>ClientAdapterCustomizer</code> methods and contracts of <code>CompositeClientAdapter</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="known-limitations"><a class="anchor" href="#known-limitations"></a>Known Limitations</h3>
<div class="sect3">
<h4 id="serialization-limitations"><a class="anchor" href="#serialization-limitations"></a>Serialization Limitations</h4>
<div class="paragraph">
<p>The HTTP adapter utilizes <a href="http://json-b.net/">JSON-B</a> for serialization. This places limits on types of objects that can be transmitted as method arguments or return types. The serialization can be customized by means of JSON-B annotations.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By default, only public properties and fields are transferred</p>
</li>
<li>
<p>Complex object graphs should form a tree and not contain cyclic references</p>
</li>
<li>
<p>Polymorphism is not supported by default</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="programming-model-limitations"><a class="anchor" href="#programming-model-limitations"></a>Programming Model Limitations</h4>
<div class="paragraph">
<p>The HTTP adapter uses stateless HTTP requests. In its current form, it is unfit for invoking stateful objects like <code>@Stateful</code> Enterprise Java Beans, or using server resources like <code>DataSource</code> or <code>ConnectionFactory</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persistent-timers"><a class="anchor" href="#persistent-timers"></a>Advanced Persistent Timer Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If using an external RDBMS engine for storing persistent timer data is not an option, it is also possible to use the Domain Data Grid to function as a replacement in production environments. The same feature is available in <a href="#/documentation/payara-micro/persistent-ejb-timers.adoc" class="page unresolved">Payara Micro</a>.</p>
</div>
<div class="paragraph">
<p>Persisting an EJB Timer to the Domain Data Grid means that the Data Grid itself will store the timer details, preserving it even if the original instance leaves the grid.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All stored timers are lost if the whole domain is stopped.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Persistence service for EJB Timers can be set in the administration console by navigating to the <strong>EJB Timer Service</strong> tab in the EJB Container node of a configuration.</p>
</div>
<div class="paragraph">
<p>To use the Data Grid to store EJB Timers set the <strong>Persistence Service</strong> to <em>DataGrid</em></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/ejb/set-ejb-timer-persistence.png" alt="Set EJB Persistence to Data Grid"></span></p>
</div>
<div class="paragraph">
<p>EJB Timers will be coordinated across a single deployment group and if an instance of the deployment group is stopped another instance in the same deployment group will take ownership of the timer and ensure it is fired.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Clustered Timer Firing Mode is NOT used in this version of Payara Server and is always "One Per Deployment Group"
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to set the <code>ejb-timer-service</code> from the command line. To get the current state, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; get configs.config.${your-config}.ejb-container.ejb-timer-service</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return the current state taken from the <em>domain.xml</em> configuration file, which by default should be something similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; get configs.config.server-config.ejb-container.ejb-timer-service
configs.config.server-config.ejb-container.ejb-timer-service.ejb-timer-service=Database
configs.config.server-config.ejb-container.ejb-timer-service.max-redeliveries=1
configs.config.server-config.ejb-container.ejb-timer-service.minimum-delivery-interval-in-millis=1000
configs.config.server-config.ejb-container.ejb-timer-service.redelivery-interval-internal-in-millis=5000
Command get executed successfully.</code></pre>
</div>
</div>
<div class="paragraph">
<p>To persist to the Data Grid you need only change the value for <code>configs.config.server-config.ejb-container.ejb-timer-service.ejb-timer-service</code> to <code>DataGrid</code>. To do this, run the following <code>set</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">asadmin&gt; set configs.config.server-config.ejb-container.ejb-timer-service.ejb-timer-service=DataGrid</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>set</code> commands are not dynamic. You will need to restart your domain to apply the changes.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="timer-migration"><a class="anchor" href="#timer-migration"></a>Timer Migration</h3>
<div class="paragraph">
<p>EJB Timers stored in the Domain Data Grid support timer migration between Instances in the same Deployment Group. You can migrate timers using the Administration console from the <strong>Deployment Group</strong> page. Timers can also be migrated between instances using asadmin commands like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; migrate-timers --target server1 server2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>server1</code> is the active instance to migrate timers to and <code>server2</code> is the failed instance.</p>
</div>
<div class="sect3">
<h4 id="migration-live-instance"><a class="anchor" href="#migration-live-instance"></a>Migration from Live Instances</h4>
<div class="paragraph">
<p>The <code>migrate-timers</code> command can also be used to migrate timers that are scheduled to expire on a live instance. This
allows a user to pre-emptively move their timers around without having to resort to failover mechanics.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mbd-bean-pool-size"><a class="anchor" href="#mbd-bean-pool-size"></a>Configuring MDB Bean Pool Size with ActivationConfigProperty</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is now possible to configure the MDB bean pool size with the <code>ActivationConfigProperty</code>. Any bean annotated with <code>@MessageDriven</code> can use <code>@ActivationConfigProperty</code> to set property names and property values. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ActivationConfigProperty(propertyName = "MaxPoolSize", propertyValue = "100")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MaxPoolSize</code>, <code>MaxWaitTimeInMillis</code>, <code>PoolResizeQuantity</code>, <code>SteadyPoolSize</code> and <code>PoolIdleTimeoutInSeconds</code> are all MDB pool properties that can configured using the <code>@ActivationConfigProperty</code> annotation.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
