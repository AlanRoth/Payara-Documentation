<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>New Relic Notifier :: Payara Documentation Preview</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../../../../_/css/site.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
    <meta name="docsearch:version" content="5.36.0" />
  </head>
  <body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../../../..">Payara Documentation Preview</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-item hide-for-print">
        Version: <div class="page-versions">
  <button class="version-menu-toggle single-version" title="Current version">5.36.0</button>
</div>

      </div>
      <div class="navbar-item hide-for-print">
            <div id="search-input-container">
    </div>
      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.payara.fish/products/downloads/">Download</a>
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary enterprise" href="../../../../../../../enterprise">Documentation for Payara Enterprise</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.36.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">5.36.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../../index.html">5.36.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../Overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">docs</a></li>
    <li><a href="New%20Relic.html">New Relic Notifier</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/alanroth/Workspace/Payara-Documentation/docs/modules/ROOT/pages/Technical%20Documentation/Payara%20Server%20Documentation/Extensions/Notifiers/New%20Relic.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">New Relic Notifier</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://newrelic.com/">New Relic</a> is an application performance monitoring (APM) tool that can be used to gather statistics and notify on key critical events generated by different type of applications. New Relic specializes on integrating Java application servers like GlassFish, JBoss WildFly, etc. and other application frameworks seamlessly.</p>
</div>
<div class="paragraph">
<p>Payara Server Enterprise includes a special notifier to send notifications from the Notification service to the New Relic <strong>Insights service</strong> using its remote API.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="downloads"><a class="anchor" href="#downloads"></a>Downloads</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://nexus.payara.fish/repository/payara-artifacts/fish/payara/extensions/notifiers/newrelic-notifier-core/1.0/newrelic-notifier-core-1.0.jar">New Relic Notifier Core 1.0</a></p>
</li>
<li>
<p><a href="https://nexus.payara.fish/repository/payara-artifacts/fish/payara/extensions/notifiers/newrelic-notifier-console-plugin/1.0/newrelic-notifier-console-plugin-1.0.jar">New Relic Notifier Console Plugin 1.0</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="newrelic-integration-configuration"><a class="anchor" href="#newrelic-integration-configuration"></a>New Relic Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order for the notifier to work correctly, you must complete the following requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a New Relic user account. You can signup for a new account <a href="https://newrelic.com/signup">here</a></p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
New Relic offers 14-days trial accounts that can be used to test the service for free.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure application performance monitoring (APM) for a Payara Server Enterprise instance by installing a New Relic Java agent</p>
</li>
<li>
<p>Configure a New Relic Insights API key that will be used to setup the notifier.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="configure-apm"><a class="anchor" href="#configure-apm"></a>Configure Application Performance Monitoring for Payara Server</h3>
<div class="paragraph">
<p>The first task is to set up the New Relic Java agent in Payara Server. To do that, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Login to New Relic with your account credentials, and if you haven&#8217;t setup a monitoring agent yet, the following screen will be shown:</p>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/agent-setup-1.png" alt="New Relic agent setup welcome screen"></span></p>
</div>
</li>
<li>
<p>Select the <strong>Java</strong> option and the agent installation procedure will be shown:</p>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/agent-setup-2.png" alt="New Relic Java agent setup procedure"></span></p>
</div>
<div class="paragraph">
<p>From the screen shown, copy the value of the <em>License Key</em> (you need to press the <strong>Reveal License Key</strong> button first) since you will need it later.</p>
</div>
</li>
<li>
<p>Now, on the same screen press the <strong>Download the Java Agent</strong>. This will download the Java agent files to your station. Unzip the files and copy the resulting folder to the root folder of the Payara Server domain you want to monitor. In the following example we are copying it to the default domain <code>domain1</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">unzip newrelic-java-3.XX.X.zip
mv newrelic ${PAYARA_INSTALL_DIR}/glassfish/domains/domain1</code></pre>
</div>
</div>
</li>
<li>
<p>Before proceeding to install the agent into the Payara Server domain, we need to configure the License Key we got earlier. To do this, modify the agent&#8217;s configuration file that&#8217;s located at <em>${PAYARA_DOMAIN_DIR}/newrelic/newrelic.yml</em> by using the <code>license_key</code> property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  # ...
  # This section is for settings common to all environments.
  # Do not add anything above this next line.
  common: &amp;default_settings

    # ============================== LICENSE KEY ===============================
    # You must specify the license key associated with your New Relic
    # account. ...
    license_key: '073f5089681d0e96d5e0a9691251a626ea90286d'

    # Agent Enabled
    # Use this setting to disable the agent instead of removing it from the startup command.
    # Default is true.
    agent_enabled: true

    # Set the name of your application as you'd like it show up in New Relic.
    # ...
    app_name: Payara Server w/ APM

    # ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We also recommend setting the name of the application under the <code>app_name</code> property to correctly identify this server&#8217;s domain on the APM dashboard
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The License Key value must be inserted using single quotes (')
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Now, proceed to install the agent by running the following command at the root of the domain folder:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">java -jar newrelic/newrelic.jar install</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the installation was successful, the output of the agent&#8217;s installer will show it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">***** ( ( o))  New Relic Java Agent Installer
***** Installing version 3.39.1 ...

* Backed up start script to /opt/payara-4.1.2.172/glassfish/domains/domain1/config/domain.xml.20170613_180108
* Added agent switch to start script /opt/payara-4.1.2.172/glassfish/domains/domain1/config/domain.xml

* No need to create New Relic configuration file because:
 A config file already exists: /opt/payara-4.1.2.172/glassfish/domains/domain1/newrelic/newrelic.yml

***** Install successful

***** Next steps:
You\'re almost done! To see performance data for your app:

1) Restart your app server
2) Exercise your app
3) Log into http://rpm.newrelic.com

Within two minutes, your app should show up, ready to monitor and troubleshoot.
If app data doesn\'t appear, check newrelic/logs/newrelic_agent.log for errors.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The installer will modify the domain.xml configuration file of your server&#8217;s domain and add the configuration of the Java agent as a JVM start argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;java-config classpath-suffix="" debug-options="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=9009" system-classpath=""&gt;
  &lt;jvm-options&gt;-javaagent:${com.sun.aas.instanceRoot}/newrelic/newrelic.jar&lt;/jvm-options&gt;
  &lt;jvm-options&gt;-server&lt;/jvm-options&gt;
&lt;/java-config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The agent setup page has a different set of instructions for Windows and Linux environments, but they are so similar that the instructions mentioned here should be sufficient.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are considering installing the New Relic Java agent on a Payara Server standalone instance or a cluster of multiple instances, you need to manually add the JVM (the installer won&#8217;t work) option with the <code>javaagent</code> configuration to the instance/cluster referenced configuration. Also, make sure that the directory where the <em>newrelic.jar</em> resides also contains the <em>newrelic.yml</em> configuration file
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Now that the agent has been installed, start the Payara Server domain. You will observe the following messages at the start of the domain&#8217;s log</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-log hljs" data-lang="log">INFO: New Relic Agent: Loading configuration file "/opt/payara/glassfish/domains/domain1/newrelic/newrelic.yml"
INFO: New Relic Agent: Writing to log file: /opt/payara/glassfish/domains/domain1/newrelic/logs/newrelic_agent.log
...</code></pre>
</div>
</div>
</li>
<li>
<p>After some minutes with the server working, you can login back to the New Relic portal and on the <strong>APM</strong> dashboard you can see a new entry for recently configured server:</p>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/apm-dashboard.png" alt="New Relic APM Dashboard"></span></p>
</div>
<div class="paragraph">
<p>You can also access the latest monitoring statistics:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/apm-application-details.png" alt="New Relic Application Details"></span></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-api-key"><a class="anchor" href="#retrieving-api-key"></a>Retrieving the API Key from New Relic Insights</h3>
<div class="paragraph">
<p>Now that the agent has been correctly installed, login back to your New Relic account portal and head to the <strong>Insights</strong> dashboard:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/insights-dashboard.png" alt="New Relic Insights Dashboard"></span></p>
</div>
<div class="paragraph">
<p>Access the <em>Manage Data</em> option on the side menu, you will be presented the following screen:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/insights-api-keys-screen.png" alt="New Relic Insights API Keys"></span></p>
</div>
<div class="paragraph">
<p>Click on the <code>+</code> icon at the side of the <strong>Insert Keys</strong> header. Take note of the  <em>Account ID</em> and <em>API Key</em> value on this screen. Also add a brief description to reference this key on the dashboard:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/insights-insert-api-key.png" alt="New Relic Insights Insert API Keys"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="payara-server-configuration"><a class="anchor" href="#payara-server-configuration"></a>Payara Server Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the New Relic Java agent and Insights API Key correctly configured, you can proceed to configure the New Relic notifier on the Payara Server domain.</p>
</div>
<div class="sect2">
<h3 id="using-the-admin-console"><a class="anchor" href="#using-the-admin-console"></a>Using the Admin Console</h3>
<div class="paragraph">
<p>To configure the Notification Service in the Admin Console, go to <em>Configuration &#8594; [instance-configuration (like server-config)] &#8594; Notification Service</em> and click on the <strong>New Relic</strong> tab:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/admin-console-configuration.png" alt="New Relic Configuration on Admin Console"></span></p>
</div>
<div class="paragraph">
<p>Check the <strong>Enabled</strong> box (and the <strong>Dynamic</strong> box too if you don&#8217;t want to restart the domain) and input the New Relic Account ID and the newly inserted Insights API Key. Hit the <strong>Save</strong> button to preserve the changes.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-asadmin-cli"><a class="anchor" href="#using-the-asadmin-cli"></a>Using the Asadmin CLI</h3>
<div class="paragraph">
<p>To configure the Notification Service from the command line, use the <code>set-newrelic-notifier-configuration</code> asadmin command, specifying the tokens like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin&gt; set-newrelic-notifier-configuration --dynamic=true --enabled=true --accountId=1658989 --key=b5815wdxj6lF_tmMBljQa5y1603JTiLh</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>--enabled</code> and <code>--dynamic</code> options to enable or disable the New Relic notifier on demand.</p>
</div>
<div class="paragraph">
<p>Also, you can retrieve the current configuration for the New Relic notifier using the <code>get-newrelic-notifier-configuration</code> asadmin command like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">asadmin &gt; get-newrelic-notifier-configuration

Enabled  Noisy  Key                               Account Id
true     true   b5815wdxj6lF_tmMBljQa5y1603JTiLh  1658989</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a>Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you have correctly configured the New Relic notifier, it can be used observe notification events on the New Relic Insights service dashboard. If you do not see any notification event messages on the data explorer, check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is the New Relic notifier enabled?</p>
</li>
<li>
<p>Is the Notification Service itself enabled?</p>
</li>
<li>
<p>Is there a service configured to use the notifier? (e.g. the HealthCheck service)</p>
</li>
<li>
<p>Is the service configured to send notifications frequently enough to observe?</p>
</li>
<li>
<p>Have you enabled the service after configuring it?</p>
</li>
<li>
<p>Is the <strong>Java Agent</strong> for your Payara Server&#8217;s domain correctly configured?</p>
</li>
<li>
<p>Have you created a valid API Key for the Insights service?</p>
</li>
<li>
<p>Does your account ID and the Insights API key match the ones configured on the Payara Server notifier?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s a sample of how these notifications are visualized on the Data Explorer dashboard for the New Relic Insights service:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../../_images/notification-service/newrelic/insights-data-explorer-results.png" alt="New Relic Insights Data Explorer"></span></p>
</div>
<div class="paragraph">
<p>You can observe that the events are correctly identified depending the severity of the notification and they are correctly grouped by their custom category (in the image only the <strong>Healthcheck</strong> events are shown).</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../../../_/js/site.js"></script>
<script async src="../../../../../../_/js/vendor/highlight.js"></script>
<script async src="../../../../../../_/js/vendor/docSearch.js"></script>
  </body>
</html>
